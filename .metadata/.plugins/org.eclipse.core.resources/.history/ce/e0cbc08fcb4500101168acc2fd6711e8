package com.test.library.service.impl;

import org.hibernate.query.Page;
import org.springframework.data.domain.PageRequest;
import org.springframework.stereotype.Service;

import com.fasterxml.jackson.databind.ObjectMapper;
import com.test.library.dto.FindBooksReqDto;
import com.test.library.dto.FindBooksResDto;
import com.test.library.entity.Book;
import com.test.library.repository.LibraryRepository;
import com.test.library.service.LibraryService;

import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;

@Slf4j
@Service
@RequiredArgsConstructor
public class LibraryServiceImpl implements LibraryService {

	private final LibraryRepository libraryRepo;
	private final ObjectMapper objectMapper;
	
	/*
	public LibraryServiceImpl(LibraryMapper libraryMapper, ObjectMapper objectMapper) {
		this.libraryMapper = libraryMapper;
		this.objectMapper = objectMapper;
	}
	 * */
	
	@Override
	public FindBooksResDto findBooks(FindBooksReqDto request) {
		try {
			
			log.info("## findBooks? - {}", objectMapper.writeValueAsString(request));
			
			int pageNo = request.getPageNo();
			String keyword = request.getKeyword();
			
			Page<Book> resBody = libraryRepo.findBookByTitle(keyword, PageRequest.of(pageNo, 20));
			
			return FindBooksResDto.from(604, "조회에 실패하였습니다.");
			
		} catch(Exception e) {
			log.error("## ERROR findBooks - {}", e.getMessage(), e);
			return FindBooksResDto.from(604, "조회에 실패하였습니다.");
		}
	}
	
}
